

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
    <title>找回密码 - 深圳捷多邦科技有限公司</title>
    <link href="css/reg.css" rel="stylesheet" type="text/css" />
    <link href="css/icon.css" rel="stylesheet"
        type="text/css" />
    <link href="css/easyui.css"
        rel="stylesheet" type="text/css" />

    <script src="js/jquery-1.8.0.min.js" type="text/javascript"></script>

    <script src="js/jquery.easyui.min.js" type="text/javascript"></script>

    <script src="js/easyui-lang-zh_CN.js"
        type="text/javascript"></script>

</head>
<body>
    <div class="header">
        <div class="logo">
            <a href="">
                <img src="img/logo.png" /></a></div>
        <span class="toplink"><a href="about/">了解更多</a> | <a href="">返回首页</a></span>
    </div>
    <form id="form1" method="post" action="editpwd.aspx?act=check">
    <div class="regmain">
        <div class="warn">
            欢迎注册捷多邦免帐号！此帐号可以完成一站式线路板打样，请保管好帐号，以免造成不必要的损失。</div>
        <div class="box">
            <div class="regleftbar" id="forgetpwd">
                <h3 class="tit">
                    找回密码</h3>
                <ul class="regstep fr mtop8">
                    <li class="green">填写注册手机号</li><li>修改密码</li><li>完成</li></ul>
                <div class="clear">
                </div>
                <div class="regform mtop20">
                    <dl>
                        <dt><em>*</em>手机号码</dt><dd class="phone"><input id="txtMobile" type="text" name="txtMobile"
                            class="txtstyle1  easyui-validatebox" data-options="required:true,validType:['tel','exists']" />
                            <div>
                                请填写手机号码</div>
                           
                        </dd>
                    </dl>
                    <dl>
                        <dt ><em>*</em>验证码</dt><dd  class="phone"><input id="txtvcode" name="txtvcode" type="text" class="txtstyle1  easyui-validatebox" style="width:100px; background-image:url('')">
                         <img src="img/verifyimage.png" name="imgCode" height="26" id="imgCode" onclick="$('#imgCode').attr('src','common/verifyimage.aspx?t='+new Date().getTime());" />
                            <a href="javascript:void(0);" onclick="$('#imgCode').attr('src','common/verifyimage.aspx?t='+new Date().getTime());">
                                换一张</a>
                                 <div class="freeyzm" >
                                <a  style="width:165px; margin-top:6px" id="aMsg" href="javascript:getMsg();">获取手机校验码</a></div>
                        </dd>
                    </dl>
                    <dl>
                        <dt><em>*</em>手机校验码</dt><dd><input id="txtcode" name="txtcode" type="text" class="txtstyle1  easyui-validatebox"
                            data-options="required:true"  /><div>
                                请查收手机短信，并填写短信中的验证码</div>
                        </dd>
                    </dl>
                    <dl>
                        <dt>&nbsp;</dt><dd class="btnstyle1"><input id="checkbox1" class="forgetpwd" type="button" value="确认"
                            onclick="check()" /></dd></dl>
                </div>
            </div>
            <div class="regleftbar" id="editpwd" style="display:none">
                <h3 class="tit">
                    修改密码</h3>
                <ul class="regstep two fr mtop8">
                    <li class="green">填写注册手机号</li><li class="green">修改密码</li><li>完成</li></ul>
                <div class="clear">
                </div>
                <div class="regform mtop20">
                    <dl>
                        <dt><em>*</em>新密码</dt><dd><input type="password" data-options="required:true,validType:'length[6,16]'" class="easyui-validatebox validatebox-text" name="txtPwd" id="txtPwd"><div>
                                6~16个字符，区分大小写</div>
                        </dd>
                    </dl>
                    <dl>
                        <dt><em>*</em>确认密码</dt><dd><input type="password" validtype="equals['#txtPwd']" required="required" class="easyui-validatebox validatebox-text" name="txtPwd1" id="txtPwd1"><div>
                                请再次填写密码</div>
                        </dd>
                    </dl>
                    <dl> 
                        <dt>&nbsp;</dt><dd class="btnstyle1">
                        <input type="hidden" value="14759167496" name="txtMobile" id="txtMobile"> 
                            <input type="hidden" value="29274" name="txtcode" id="txtcode"> 
                        <input name="step" type="hidden" value="{$step}" />
                        <input type="submit" value="修改密码" id="checkbox1" class="editpwd"></dd></dl>
                </div>
            </div>
            <script type="text/javascript">
                $(function(){
                    $(".forgetpwd").click(function(){
                        $("input[name='step']").val(1);
                    })
                    $(".editpwd ").click(function(){
                        $("input[name='step']").val(2)
                    });
                    if(false){

                        $("#forgetpwd").remove();
                        $("#editpwd").show();
                    }
                })
            </script>
            <div class="regrightbar">
                <div>
                    <h3>
                        已有捷多邦帐号</h3>
                    <p>
                        <a href="login.aspx">立即登录</a></p>
                    <span>忘记登录密码请选择<a href="forgetpwd.aspx">找回密码</a></span>
                </div>
                <ul>
                    <li>24小时服务热线：<br />
                        400-852-8880
</li></ul>
            </div>
        </div>
		<div class="cowcng">
            30分钟快速报价 单面、双面加急24、48小时 4层板加急48、72小时 | 公司地址：深圳市福田区福明路雷圳大厦2206 | 咨询电话：400-852-8880
</div>
        <div class="cowcng1">
            深圳捷多邦科技有限公司版权所有 <a href="http://www.miibeian.gov.cn/" target="_blank">浙ICP备10014259号-118</a>
        </div>
    </div>
    </form>
</body>
</html>

<script type="text/javascript">
    var width = $("#aMsg").css("width"); var sec = 60;
    var timerId = 0;
    $.ajaxSetup({
        url: "ajax.aspx",
        global: false,
        type: "GET",
        async: false

    });

    $.extend($.fn.validatebox.defaults.rules, {
        equals: {
            validator: function(value, param) {
                return value == $(param[0]).val();
            },
            message: '2次密码不一样.'
        },
        exists: {
            validator: function(value, param) {
                var d = "";
                $.get("ajax.aspx?act=CheckMobile&val=" + value + "&t=" + new Date(), function(r) { d = r; });
                return d == "1";
            },
            message: '该手机未注册'
        },
        tel: {
            validator: function(value, param) {
                var telReg = /^(13[0-9]|14[7]|15[0-9]|18[0-9])\d{8}$/;
                return telReg.test(value);
            },
            message: '手机不合法'
        }
    });

    function getMsg() {
        var mobile = $.trim($("#txtMobile").val());
        var txtvcodele = $.trim($("#txtvcode").val());



        if (mobile.length < 11) { $.messager.alert('确认', '请先填写的手机号码。'); return; }
        if (txtvcodele.length < 4) { $.messager.alert('确认', '请先填写验证码再试。'); return; }
        $.get("ajax.aspx?act=SendMsg&mobile=" + mobile + "&vcode=" + txtvcodele + "&t=" + new Date().getTime(), function(data) {

            if (data == "成功") {
                $("#aMsg").removeAttr("href");
                $("#aMsg").css("width", "200px");
                $("#aMsg").text("已发送,60秒后重新获取");
                sec = 60;
                timerId=setInterval(setText, 1000);
            }
            else {
                $.messager.alert('发送失败', data + ",请重试或在线联系我们");
            }

        });
    }

    function check() {
        var b = $("#form1").form('validate');

        if (b) {
            var mobile = $.trim($("#txtMobile").val());
            $.get("ajax.aspx?act=CheckPwdCode&mobile=" + mobile + "&code=" + $("#txtcode").val() + "&t=" + new Date().getTime(), function(data) {
                if (data == "成功") {
                    $("#form1").submit();
                }
                else {
                    $.messager.alert('发送失败', data + ",请重试或在线联系我们");
                }


            });

        }
    }

    function setText() {
        sec--;
        if (sec <= 0) {
            $("#aMsg").attr("href", "javascript:getMsg()");
            $("#aMsg").css("width", width);
            $("#aMsg").text("获取验证码");

            clearInterval(timerId);
        }
        else {
            $("#aMsg").text("已发送," + sec + "秒后重新获取");
        }
    }
</script>


